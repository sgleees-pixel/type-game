<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“± íƒ€ì ì—°ìŠµ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap');
        
        body {
            font-family: 'Gaegu', cursive;
            background-color: #f0f9ff;
            touch-action: manipulation;
        }
        .correct { color: #3b82f6; }
        .incorrect { color: #ef4444; text-decoration: underline; }
        .current { background-color: #fef08a; border-radius: 4px; }
        
        .game-card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="setup-screen" class="max-w-md w-full bg-white rounded-3xl p-8 game-card text-center">
        <h1 class="text-4xl font-bold text-blue-500 mb-6">âŒ¨ï¸ ë°˜ì§ë°˜ì§ íƒ€ìêµì‹¤</h1>
        <p class="text-xl text-gray-600 mb-8">ë¬´ì—‡ì„ ì¢‹ì•„í•˜ë‚˜ìš”? <br>ì¢‹ì•„í•˜ëŠ” ê²ƒì„ ì“°ë©´ ë¬¸ì¥ì„ ë§Œë“¤ì–´ ì¤„ê²Œìš”!</p>
        
        <input type="text" id="interest-input" 
               placeholder="ì˜ˆ: ê°•ì•„ì§€, ìš°ì£¼, ê³µì£¼ë‹˜" 
               class="w-full text-2xl p-4 border-4 border-blue-200 rounded-2xl mb-6 focus:outline-none focus:border-blue-400 text-center">
        
        <button onclick="startGame()" 
                class="w-full bg-blue-500 hover:bg-blue-600 text-white text-2xl font-bold py-4 rounded-2xl transition-all transform hover:scale-105">
            ê²Œì„ ì‹œì‘í•˜ê¸°!
        </button>
    </div>

    <div id="loading-screen" class="hidden max-w-md w-full bg-white rounded-3xl p-8 game-card text-center">
        <div class="flex flex-col items-center">
            <div class="spinner mb-4"></div>
            <p class="text-2xl text-blue-500">ì¬ë¯¸ìˆëŠ” ë¬¸ì¥ì„ ë§Œë“¤ê³  ìˆì–´ìš”...</p>
        </div>
    </div>

    <div id="game-screen" class="hidden max-w-2xl w-full bg-white rounded-3xl p-8 game-card">
        <div class="flex justify-between mb-6 text-xl text-gray-500 border-b pb-4">
            <div>ì •í™•ë„: <span id="accuracy-display" class="font-bold text-blue-500">100</span>%</div>
            <div>ì§„í–‰: <span id="progress-display" class="font-bold text-blue-500">0</span> / 5</div>
        </div>

        <div class="mb-12">
            <div id="target-sentence" class="text-3xl sm:text-4xl text-gray-700 leading-relaxed mb-8 break-keep min-h-[80px]">
                <!-- Sentence will be here -->
            </div>
            
            <input type="text" id="typing-input" 
                   class="w-full text-3xl p-4 border-b-4 border-blue-300 focus:outline-none focus:border-blue-500 text-center"
                   placeholder="ìœ„ ë¬¸ì¥ì„ ë”°ë¼ ì¨ë³´ì„¸ìš”"
                   autocomplete="off">
        </div>

        <div class="flex justify-center">
            <button onclick="resetGame()" class="text-gray-400 hover:text-gray-600">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div id="result-screen" class="hidden max-w-md w-full bg-white rounded-3xl p-8 game-card text-center">
        <h2 class="text-4xl font-bold text-yellow-500 mb-4">ğŸ‰ ëŒ€ë‹¨í•´ìš”! ğŸ‰</h2>
        <div class="bg-yellow-50 rounded-2xl p-6 mb-6">
            <p class="text-2xl mb-2">í‰ê·  ì •í™•ë„: <span id="final-accuracy" class="font-bold text-blue-500">0</span>%</p>
            <p id="final-message" class="text-xl text-gray-600">íƒ€ì ì‹¤ë ¥ì´ ì‘¥ì‘¥ ëŠ˜ê³  ìˆì–´ìš”!</p>
        </div>
        <button onclick="resetGame()" 
                class="w-full bg-blue-500 hover:bg-blue-600 text-white text-2xl font-bold py-4 rounded-2xl transition-all">
            í•œ ë²ˆ ë” í•˜ê¸°
        </button>
    </div>

    <script>
        const apiKey = ""; // API key will be provided at runtime
        const setupScreen = document.getElementById('setup-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        
        const interestInput = document.getElementById('interest-input');
        const typingInput = document.getElementById('typing-input');
        const targetDisplay = document.getElementById('target-sentence');
        const progressDisplay = document.getElementById('progress-display');
        const accuracyDisplay = document.getElementById('accuracy-display');

        let sentences = [];
        let currentIndex = 0;
        let totalErrors = 0;
        let totalChars = 0;

        async function fetchSentences(interest) {
            const systemPrompt = "ë„ˆëŠ” ì´ˆë“±í•™êµ 1-2í•™ë…„ ìˆ˜ì¤€ì˜ ì–¸ì–´ êµì‚¬ì•¼. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê´€ì‹¬ì‚¬ ì£¼ì œë¡œ 5ê°œì˜ ì•„ì£¼ ì§§ê³  ì‰¬ìš´ ë¬¸ì¥ì„ ë§Œë“¤ì–´ì¤˜. ê° ë¬¸ì¥ì€ 10ì ë‚´ì™¸ì—¬ì•¼ í•˜ë©°, ë°›ì¹¨ì´ ë„ˆë¬´ ì–´ë µì§€ ì•Šì•„ì•¼ í•´. ìƒëª… ìœ¤ë¦¬ì— ì–´ê¸‹ë‚˜ê±°ë‚˜, ë²”ì£„, í˜ì˜¤ í‘œí˜„ì€ ì ˆëŒ€ ì•ˆ ë¼. ì¹­ì°¬í•˜ê³  ë°ì€ ëŠë‚Œì˜ ë¬¸ì¥ì´ì–´ì•¼ í•´. ì‘ë‹µì€ ì˜¤ì§ JSON ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œë§Œ í•´ì¤˜. ì˜ˆ: ['ë‚˜ëŠ” ì‚¬ê³¼ë¥¼ ì¢‹ì•„í•´ìš”.', 'ë¹¨ê°„ ì‚¬ê³¼ëŠ” ë§›ìˆì–´ìš”.']";
            const userQuery = `${interest}ì— ê´€í•œ ì´ˆë“± 1~2í•™ë…„ ìˆ˜ì¤€ì˜ íƒ€ì ì—°ìŠµìš© ë¬¸ì¥ 5ê°œ ë§Œë“¤ì–´ì¤˜.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    })
                });

                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                return JSON.parse(text);
            } catch (error) {
                console.error(error);
                return [
                    `${interest}ì€ ì •ë§ ë©‹ì ¸ìš”.`,
                    `ìš°ë¦¬ ê°™ì´ ${interest} êµ¬ê²½í•´ìš”.`,
                    `${interest} ì¹œêµ¬ë¥¼ ë§Œë‚˜ìš”.`,
                    `${interest} ì •ë§ ì‚¬ë‘ìŠ¤ëŸ¬ì›Œìš”.`,
                    `ë‚´ì¼ë„ ${interest}ì´ë‘ ë†€ì•„ìš”.`
                ];
            }
        }

        async function startGame() {
            const interest = interestInput.value.trim();
            if (!interest) {
                alert('ê´€ì‹¬ì‚¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            setupScreen.classList.add('hidden');
            loadingScreen.classList.remove('hidden');

            sentences = await fetchSentences(interest);
            
            currentIndex = 0;
            totalErrors = 0;
            totalChars = 0;
            
            loadingScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            showSentence();
            typingInput.focus();
        }

        function showSentence() {
            const sentence = sentences[currentIndex];
            targetDisplay.innerHTML = '';
            // ì‹œê°ì  í”¼ë“œë°±ì„ ìœ„í•´ ê¸€ì ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ ë„£ìŒ
            sentence.split('').forEach(char => {
                const span = document.createElement('span');
                span.innerText = char;
                targetDisplay.appendChild(span);
            });
            
            typingInput.value = '';
            progressDisplay.innerText = currentIndex + 1;
            updateAccuracy();
        }

        typingInput.addEventListener('input', () => {
            const currentSentence = sentences[currentIndex];
            const val = typingInput.value;
            const spans = targetDisplay.querySelectorAll('span');

            let errors = 0;
            spans.forEach((span, i) => {
                if (i < val.length) {
                    if (val[i] === currentSentence[i]) {
                        span.className = 'correct';
                    } else {
                        span.className = 'incorrect';
                        errors++;
                    }
                } else if (i === val.length) {
                    span.className = 'current';
                } else {
                    span.className = '';
                }
            });

            // ë¬¸ì¥ì´ ì™„ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (val === currentSentence) {
                totalChars += currentSentence.length;
                nextStep();
            }
        });

        function nextStep() {
            currentIndex++;
            if (currentIndex < sentences.length) {
                showSentence();
            } else {
                showResults();
            }
        }

        function updateAccuracy() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë¬¸ì¥ ì™„ë£Œ ì‹œì˜ ì •í™•ë„ë¥¼ í•©ì‚°í•˜ì—¬ ê³„ì‚°
            accuracyDisplay.innerText = currentIndex === 0 ? "100" : Math.max(70, 100 - (totalErrors * 2));
        }

        function showResults() {
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            document.getElementById('final-accuracy').innerText = "100";
        }

        function resetGame() {
            resultScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            interestInput.value = '';
        }

        // Enter Key ì§€ì›
        interestInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') startGame();
        });
    </script>
</body>
</html>
